stages:
  - test
  - release
  - deploy

variables:
  BASE_URL: "https://api.meteo.cat"
  PYPI_USERNAME: $PRODUCTION_USERNAME  # Usuario de PyPI
  PYPI_PASSWORD: $PRODUCTION_PASSWORD  # Token de PyPI
  GL_TOKEN: $GL_TOKEN  # Token de GitLab
  GIT_STRATEGY: fetch
  GIT_DEPTH: 0

before_script:
  - python -V  # Verificar versi칩n de Python
  - python -m pip install --upgrade pip
  - pip install poetry  # Instalar Poetry
  - poetry config virtualenvs.create false  # Desactivar la creaci칩n de entornos virtuales
  - poetry install  # Instalar dependencias con Poetry

test_job:
  stage: test
  image: python:3.12.7  # Actualizaci칩n a Python 3.12.7
  script:
    - poetry install  # Instalar dependencias con Poetry
    - python meteocat/locations.py  # Ejecuta tu script principal
  artifacts:
    paths:
      - municipis_result.json  # Archivo que queremos guardar
    expire_in: never  # No expira. El archivo generado estar치 siempre disponible
  only:
    - master

release_job:
  image: python:3.12.7
  stage: release
  only:
    - master  # Solo ejecuta este job en la rama master
  script:
    - poetry run semantic-release version  # Ejecuta el comando para publicar el release
