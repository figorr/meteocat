name: Sync to GitLab

# Se ejecuta al hacer push en master o al crear tags
on:
  push:
    branches:
      - master
  create:
    tags:
      - 'v*'

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      # Checkout completo (fetch-depth: 0 evita problemas de shallow update)
      - name: Checkout repository
        uses: actions/checkout@v3
        with:
          fetch-depth: 0

      # Configurar Git
      - name: Configure Git
        run: |
          git config user.name "github-bot"
          git config user.email "bot@github.com"

      # AÃ±adir remoto de GitLab
      - name: Add GitLab remote
        env:
          GL_REMOTE_URL: ${{ secrets.GL_REMOTE_URL }}
          GL_TOKEN: ${{ secrets.GL_TOKEN }}
        run: |
          git remote add gitlab "https://oauth2:${GL_TOKEN}@${GL_REMOTE_URL#https://}"

      # Push de commits nuevos
      - name: Push commits to GitLab
        run: git push gitlab master

      # Push de tags nuevos
      - name: Push new tags to GitLab
        run: git push gitlab --tags
